<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><%= content_for?(:title) ? yield(:title) : "Adopt a Jerry" %></title>

    <%= favicon_link_tag '/jerry_favicon.ico' %>
    <%= stylesheet_link_tag    "application" %>
    <%= javascript_include_tag "vendor/modernizr" %>
    <script src="https://login.persona.org/include.js" type="text/javascript"></script>
    <%= csrf_meta_tags %>
  </head>

  <body>
    <%= render 'layouts/navigation' %>

    <%# display flash messages %>
    <% if flash[:alert] %>
    <p class="flash-error"><%= flash[:alert] %></p>
    <% end %>
    <% if flash[:notice] %>
    <p class="flash-notice"><%= flash[:notice] %></p>
    <% end %>
    
    <div class="row <%= controller_name %>">
      <%= yield %>
    </div>

    <%= render 'layouts/footer' %>

    <%# scripts %>
    <%= javascript_include_tag "application" %>
    <script type='text/javascript'>
      function loginViaEmail() {
        navigator.id.get(function(assertion) {
          if (assertion) {
            $('input[name=assertion]').val(assertion);
            $('#browser_id_form').submit();
          } else {
            window.location = "#{failure_path}"
          }
        });
      }

      $(function() {
        $('#browser_id_form button').click(function() {
          loginViaEmail();
          return false;
        });
      });
    </script>
  </body>
</html>
